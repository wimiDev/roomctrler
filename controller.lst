C51 COMPILER V9.54   CONTROLLER                                                            04/28/2017 20:53:52 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE CONTROLLER
OBJECT MODULE PLACED IN controller.obj
COMPILER INVOKED BY: J:\program\keil\C51\BIN\C51.EXE class\controller.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEN
                    -D PRINT(.\controller.lst) TABS(2) OBJECT(controller.obj)

line level    source

   1          #include"controller.h"
   2          unsigned char paralist[4];
   3          unsigned char number = 0;
   4          DATE currenttime;
   5          DATE closetime;//关灯时间
   6          DATE opentime;//开灯时间
   7          
   8          void controllerinit()
   9          {  
  10   1        _BEEBEE = 0;
  11   1        Initial_DS1302();
  12   1      //  DS1302_SetTime(DS1302_HOUR,10); //??????????10??54??30
  13   1      //  DS1302_SetTime(DS1302_MINUTE,54);
  14   1      //  DS1302_SetTime(DS1302_SECOND,30); 
  15   1        dbinit();
  16   1        LCD_init();  //初始化LCD模块 
  17   1        LCDcls(); //清屏幕  
  18   1        closetime.hour = 0;
  19   1        closetime.min = 0;
  20   1        closetime.sec = 0;  
  21   1      
  22   1        opentime.hour = 0;
  23   1        opentime.min = 0;
  24   1        opentime.sec = 0; 
  25   1        beebee(3);
  26   1      }
  27          
  28          void parafilter(unsigned char* list,char size)
  29          {
  30   1        char i=0;
  31   1        unsigned char val = 0;
  32   1        char id =  list[0]-'0';
  33   1        if (RevTempDate0[0]==0)
  34   1        {
  35   2          return;
  36   2        }
  37   1        for(i=1;i<size;i++)
  38   1        {
  39   2          val = (val*10)+(list[i]-'0');   
  40   2        }
  41   1        if(id==1)
  42   1        {
  43   2          paralist[0] = val;  
  44   2        }
  45   1        else if(id==2)
  46   1        {
  47   2          paralist[1] = val;  
  48   2        } 
  49   1        else if(id==3)
  50   1        {
  51   2          paralist[2] = val;  
  52   2        }
  53   1        else if(id==4)
  54   1        {
C51 COMPILER V9.54   CONTROLLER                                                            04/28/2017 20:53:52 PAGE 2   

  55   2          paralist[3] = val;
  56   2        }
  57   1        else
  58   1        {
  59   2          for(i=0;i<5;++i)
  60   2          {
  61   3            RevTempDate0[i] = 0;  
  62   3          }
  63   2          return;
  64   2        } 
  65   1        //置空接收区
  66   1        for(i=0;i<5;++i)
  67   1        {
  68   2          RevTempDate0[i] = 0;  
  69   2        }
  70   1      }
  71          void getcutrrenttime()
  72          {  
  73   1        SYSTEMTIME CurrentTime;
  74   1        DS1302_GetTime(&CurrentTime);
  75   1        TimeToStr(&CurrentTime);
  76   1        currenttime.hour=CurrentTime.Hour;
  77   1        currenttime.min=CurrentTime.Minute;
  78   1        currenttime.sec=CurrentTime.Second;
  79   1      }
  80          
  81          void cashcard(unsigned char *resdata)
  82          {
  83   1        unsigned char index = 0; 
  84   1        unsigned char len = getuartbuflen();
  85   1        unsigned char idsta[10]; 
  86   1        unsigned char insertindex = 0;
  87   1        unsigned char selectindex = 0;
  88   1        char str[30] = "cashcard"; 
  89   1        if(getreaded()== 1 ) return;//没有数据更新
  90   1        LCDcls();
  91   1        if(getreaded() == -1)
  92   1        {
  93   2          beebee(5);
  94   2          showmsg("SUPPORT-ID-CARD-ONLY!",3);
  95   2          setread(1);
  96   2          return;
  97   2        }
  98   1        beebee(2);
  99   1        for(index=0;index< len;index++)
 100   1        { 
 101   2          if(index<len)//index>4&&
 102   2          { 
 103   3            idsta[index] = *(resdata+index);//-5  
 104   3          }
 105   2          *(resdata+index) = 0;//清空数据
 106   2        }
 107   1        selectindex =  selectid(idsta);
 108   1        if(selectindex != UNKNOWERROR)
 109   1        {
 110   2          //查找到了
 111   2          number--;
 112   2          delectidbyindex(selectindex);
 113   2          sprintf(str,"NO.%d-OUT-;number-is.%d.",(int)selectindex,(int)number);
 114   2        }
 115   1        else
 116   1        {
C51 COMPILER V9.54   CONTROLLER                                                            04/28/2017 20:53:52 PAGE 3   

 117   2          //没有找到
 118   2          insertindex = insertid(idsta);
 119   2          if(insertindex == UNKNOWERROR) 
 120   2          {
 121   3            LCDprintf("--FULL--",0);
 122   3            LCDprintf("--callme--13077661594",-1);
 123   3            return;
 124   3          } 
 125   2          number++;
 126   2          sprintf(str,"NO.%d-IN-;number-is-%d.",(int)insertindex,(int)number);
 127   2        }
 128   1        showmsg(str,3);
 129   1        setread(1);
 130   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    568    ----
   CONSTANT SIZE    =    132    ----
   XDATA SIZE       =     20      77
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
