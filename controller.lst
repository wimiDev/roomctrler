C51 COMPILER V9.00   CONTROLLER                                                            04/01/2017 16:31:14 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE CONTROLLER
OBJECT MODULE PLACED IN controller.obj
COMPILER INVOKED BY: I:\program\keil\C51\BIN\C51.EXE class\controller.c LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\controll
                    -er.lst) OBJECT(controller.obj)

line level    source

   1          #include"controller.h"
   2          unsigned char paralist[4];
   3          unsigned char _page = 0;
   4          unsigned char lvsecond = 0;
   5           unsigned char number = 0;
   6          DATE currenttime;
   7          DATE closetime;//关灯时间
   8          
   9          void controllerinit()
  10          {               
  11   1              Initial_DS1302();
  12   1              DS1302_SetTime(DS1302_HOUR,10); //??????????10??54??30
  13   1              DS1302_SetTime(DS1302_MINUTE,54);
  14   1              DS1302_SetTime(DS1302_SECOND,30); 
  15   1              dbinit();
  16   1              closetime.hour = 0;
  17   1              closetime.min = 0;
  18   1              closetime.sec = 0;  
  19   1      
  20   1              LCD_init();  //初始化LCD模块 
  21   1              LCDcls(); //清屏幕      
  22   1      }
  23          void setparas(char*list)
  24          {
  25   1      
  26   1      }
*** WARNING C280 IN LINE 23 OF CLASS\CONTROLLER.C: 'list': unreferenced local variable
  27          void parafilter(unsigned char* list,char size)
  28          {
  29   1              char i=0;
  30   1              //char sendstr[30];
  31   1              unsigned char val = 0;
  32   1              char id =  list[0]-'0';
  33   1              if (RevTempDate0[0]==0)
  34   1              {
  35   2                      return;
  36   2              }
  37   1              for(i=1;i<size;i++)
  38   1              {
  39   2                      val = (val*10)+(list[i]-'0');           
  40   2              }
  41   1              if(id==1)
  42   1              {
  43   2                      paralist[0] = val;      
  44   2              }
  45   1              else if(id==2)
  46   1              {
  47   2                      paralist[1] = val;      
  48   2              } 
  49   1              else if(id==3)
  50   1              {
  51   2                      paralist[2] = val;      
  52   2              }
  53   1              else if(id==4)
C51 COMPILER V9.00   CONTROLLER                                                            04/01/2017 16:31:14 PAGE 2   

  54   1              {
  55   2                      paralist[3] = val;
  56   2              }
  57   1              else
  58   1              {
  59   2                      for(i=0;i<5;++i)
  60   2                      {
  61   3                              RevTempDate0[i] = 0;    
  62   3                      }
  63   2                      return;
  64   2              }       
  65   1              //置空接收区
  66   1              for(i=0;i<5;++i)
  67   1              {
  68   2                      RevTempDate0[i] = 0;    
  69   2              }
  70   1      }
  71          void getcutrrenttime()
  72          {  
  73   1      //      char str[20];
  74   1              SYSTEMTIME CurrentTime;
  75   1              DS1302_GetTime(&CurrentTime);
  76   1              //DateToStr(&CurrentTime);
  77   1              TimeToStr(&CurrentTime);
  78   1              currenttime.hour=CurrentTime.Hour;
  79   1              currenttime.min=CurrentTime.Minute;
  80   1              currenttime.sec=CurrentTime.Second;
  81   1      //      sprintf(str,"[%d:%d:%d]",(int)currenttime.hour,(int)currenttime.min,(int)currenttime.sec);
  82   1      //      //SendString(str);
  83   1      //      LCDcls();
  84   1      //      LCDprintf("-TIME-NOW-");
  85   1      //      LCDprintf(str);
  86   1      }
  87          void showtimeval(DATE* time,char*name)
  88          {
  89   1               char str[20];
  90   1               sprintf(str,"[%d:%d:%d]",(int)time->hour,(int)time->min,(int)time->sec);
  91   1              //SendString(str);
  92   1              LCDcls();
  93   1              LCDprintf(name);
  94   1              LCDprintf(str);
  95   1      }
  96          void trunpage()
  97          {
  98   1              if(lvsecond==0)
  99   1              {
 100   2                      if(getkey(0)==15)
 101   2                      {
 102   3                      //上翻页
 103   3                              _page++;
 104   3                              if (_page > MAXPAGE) _page = 0;
 105   3                      }
 106   2                      if(getkey(0)==11)
 107   2                      {
 108   3                      //下翻页
 109   3                              --_page;
 110   3                              if (_page>MAXPAGE-1)    _page = MAXPAGE-1;
 111   3                      }
 112   2              }
 113   1      }
 114          void uiupdater()
 115          {
C51 COMPILER V9.00   CONTROLLER                                                            04/01/2017 16:31:14 PAGE 3   

 116   1              char sendstr[30];
 117   1              trunpage();
 118   1              if (_page == 0)
 119   1              { 
 120   2                      LCDcls();
 121   2                      LCDprintf("--wellcom-----use----WIMI-DEV-");    
 122   2              }
 123   1              else if (_page==1)
 124   1              {
 125   2                      sprintf(sendstr,"a%d,b%d,c%d,d%d",(int)paralist[0],
 126   2                                 (int)paralist[1],(int)paralist[2],(int)paralist[3]);
 127   2                      //SendString(sendstr);
 128   2                      LCDcls();
 129   2                      LCDprintf(sendstr);     
 130   2              }
 131   1              else if (_page==2)
 132   1              {
 133   2                      
 134   2                      if(lvsecond==0) showtimeval(&currenttime,"-TIME-NOW-");
 135   2                      setcurrenttime(&currenttime);
 136   2              }
 137   1              else if(_page==3)
 138   1              {
 139   2                      setclosetime(&closetime);
 140   2                      if(lvsecond==0) showtimeval(&closetime,"-OFF-TIME-");
 141   2      //              {
 142   2      //              //一级菜单
 143   2      //                      LCDcls();
 144   2      //                      LCDprintf("setofftime");
 145   2      //                      sprintf(sendstr,"[%d-%d-%d]",(int)closetime.hour,(int)closetime.min,(int)closetime.sec);
 146   2      //                      LCDprintf(sendstr);
 147   2      //              }
 148   2              }       
 149   1              getkey(1);
 150   1      }
 151          void cashcard(unsigned char *resdata)
 152          {
 153   1              unsigned char index = 0; 
 154   1              unsigned char len = getuartbuflen();
 155   1              unsigned char idsta[10]; 
 156   1              unsigned char insertindex = 0;
 157   1              unsigned char selectindex = 0;
 158   1              char str[20]="cashcard"; 
 159   1              if(getreaded()) return;//没有数据更新
 160   1              LCDcls();
 161   1              for(index=0;index< len;index++)
 162   1              {       
 163   2                      if(index>4&&index<len)
 164   2                      { 
 165   3                              idsta[index-5] = *(resdata+index);      
 166   3                      }
 167   2                      setread(1);
 168   2                      *(resdata+index) = 0;//清空数据
 169   2              }
 170   1              selectindex =  selectid(idsta);
 171   1              if(selectindex != UNKNOWERROR)
 172   1              {
 173   2                      //查找到了
 174   2                      number--;
 175   2                      delectidbyindex(selectindex);
 176   2                      sprintf(str,"NO.%d-OUT-;number is.%d.",(int)selectindex,(int)number);
 177   2              }
C51 COMPILER V9.00   CONTROLLER                                                            04/01/2017 16:31:14 PAGE 4   

 178   1              else
 179   1              {
 180   2                      //没有找到
 181   2                      insertindex = insertid(idsta);
 182   2                      if(insertindex == UNKNOWERROR) 
 183   2                      {
 184   3                              LCDprintf("--FULL--");
 185   3                              LCDprintf("--callme--13077661594");
 186   3                              return;
 187   3                      } 
 188   2                      number++;
 189   2                      sprintf(str,"NO.%d-IN-;number is。%d。",(int)insertindex,(int)number);
 190   2              }
 191   1              LCDprintf(str); 
 192   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    940    ----
   CONSTANT SIZE    =    182    ----
   XDATA SIZE       =     17     126
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
