C51 COMPILER V9.00   CONTROLLER                                                            04/10/2017 20:02:32 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE CONTROLLER
OBJECT MODULE PLACED IN controller.obj
COMPILER INVOKED BY: I:\program\keil\C51\BIN\C51.EXE class\controller.c LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\controll
                    -er.lst) OBJECT(controller.obj)

line level    source

   1          #include"controller.h"
   2          unsigned char paralist[4];
   3          unsigned char _page = 0;
   4          unsigned char lvsecond = 0;
   5           unsigned char number = 0;
   6          DATE currenttime;
   7          DATE closetime;//关灯时间
   8          DATE opentime;//开灯时间
   9          
  10          void controllerinit()
  11          {               
  12   1              Initial_DS1302();
  13   1              DS1302_SetTime(DS1302_HOUR,10); //??????????10??54??30
  14   1              DS1302_SetTime(DS1302_MINUTE,54);
  15   1              DS1302_SetTime(DS1302_SECOND,30); 
  16   1              dbinit();
  17   1              closetime.hour = 0;
  18   1              closetime.min = 0;
  19   1              closetime.sec = 0;  
  20   1      
  21   1              LCD_init();  //初始化LCD模块 
  22   1              LCDcls(); //清屏幕      
  23   1      }
  24          void setparas(char*list)
  25          {
  26   1      
  27   1      }
*** WARNING C280 IN LINE 24 OF CLASS\CONTROLLER.C: 'list': unreferenced local variable
  28          void parafilter(unsigned char* list,char size)
  29          {
  30   1              char i=0;
  31   1              //char sendstr[30];
  32   1              unsigned char val = 0;
  33   1              char id =  list[0]-'0';
  34   1              if (RevTempDate0[0]==0)
  35   1              {
  36   2                      return;
  37   2              }
  38   1              for(i=1;i<size;i++)
  39   1              {
  40   2                      val = (val*10)+(list[i]-'0');           
  41   2              }
  42   1              if(id==1)
  43   1              {
  44   2                      paralist[0] = val;      
  45   2              }
  46   1              else if(id==2)
  47   1              {
  48   2                      paralist[1] = val;      
  49   2              } 
  50   1              else if(id==3)
  51   1              {
  52   2                      paralist[2] = val;      
  53   2              }
C51 COMPILER V9.00   CONTROLLER                                                            04/10/2017 20:02:32 PAGE 2   

  54   1              else if(id==4)
  55   1              {
  56   2                      paralist[3] = val;
  57   2              }
  58   1              else
  59   1              {
  60   2                      for(i=0;i<5;++i)
  61   2                      {
  62   3                              RevTempDate0[i] = 0;    
  63   3                      }
  64   2                      return;
  65   2              }       
  66   1              //置空接收区
  67   1              for(i=0;i<5;++i)
  68   1              {
  69   2                      RevTempDate0[i] = 0;    
  70   2              }
  71   1      }
  72          void getcutrrenttime()
  73          {  
  74   1      //      char str[20];
  75   1              SYSTEMTIME CurrentTime;
  76   1              DS1302_GetTime(&CurrentTime);
  77   1              //DateToStr(&CurrentTime);
  78   1              TimeToStr(&CurrentTime);
  79   1              currenttime.hour=CurrentTime.Hour;
  80   1              currenttime.min=CurrentTime.Minute;
  81   1              currenttime.sec=CurrentTime.Second;
  82   1      //      sprintf(str,"[%d:%d:%d]",(int)currenttime.hour,(int)currenttime.min,(int)currenttime.sec);
  83   1      //      //SendString(str);
  84   1      //      LCDcls();
  85   1      //      LCDprintf("-TIME-NOW-");
  86   1      //      LCDprintf(str);
  87   1      }
  88          void showtimeval(DATE* time,char*name)
  89          {
  90   1               char str[20];
  91   1               sprintf(str,"[%d:%d:%d]",(int)time->hour,(int)time->min,(int)time->sec);
  92   1              //SendString(str);
  93   1              LCDcls();
  94   1              LCDprintf(name);
  95   1              LCDprintf(str);
  96   1      }
  97          void trunpage()
  98          {
  99   1              if(lvsecond==0)
 100   1              {
 101   2                      if(getkey(0)==15)
 102   2                      {
 103   3                      //上翻页
 104   3                              _page++;
 105   3                              if (_page >= MAXPAGE) _page = 0;
 106   3                      }
 107   2                      if(getkey(0)==11)
 108   2                      {
 109   3                      //下翻页
 110   3                              --_page;
 111   3                              if (_page>MAXPAGE-1)    _page = MAXPAGE-1;
 112   3                      }
 113   2              }
 114   1      }
 115          void uiupdater()
C51 COMPILER V9.00   CONTROLLER                                                            04/10/2017 20:02:32 PAGE 3   

 116          {
 117   1              char sendstr[30];
 118   1              trunpage();
 119   1              if (_page == 0)
 120   1              { 
 121   2                      LCDcls();
 122   2                      LCDprintf("--wellcom-----use----WIMI-DEV-");    
 123   2              }
 124   1              else if (_page==1)
 125   1              {
 126   2                      sprintf(sendstr,"a%d,b%d,c%d,d%d",(int)paralist[0],
 127   2                                 (int)paralist[1],(int)paralist[2],(int)paralist[3]);
 128   2                      //SendString(sendstr);
 129   2                      LCDcls();
 130   2                      LCDprintf(sendstr);     
 131   2              }
 132   1              else if (_page==2)
 133   1              {
 134   2                      
 135   2                      if(lvsecond==0) showtimeval(&currenttime,"-TIME-NOW-");
 136   2                      setcurrenttime(&currenttime);
 137   2              }
 138   1              else if(_page == 3)
 139   1              {
 140   2                      setclosetime(&closetime);
 141   2                      if(lvsecond==0) showtimeval(&closetime,"-OFF-TIME-");
 142   2              }
 143   1              else if(_page == 4)
 144   1              {
 145   2                      setclosetime(&opentime);
 146   2                      if(lvsecond==0) showtimeval(&opentime,"OPEN-TIME-");
 147   2              }       
 148   1              getkey(1);
 149   1      }
 150          void cashcard(unsigned char *resdata)
 151          {
 152   1              unsigned char index = 0; 
 153   1              unsigned char len = getuartbuflen();
 154   1              unsigned char idsta[10]; 
 155   1              unsigned char insertindex = 0;
 156   1              unsigned char selectindex = 0;
 157   1              char str[20]="cashcard"; 
 158   1              if(getreaded()) return;//没有数据更新
 159   1              LCDcls();
 160   1              for(index=0;index< len;index++)
 161   1              {       
 162   2                      if(index>4&&index<len)
 163   2                      { 
 164   3                              idsta[index-5] = *(resdata+index);      
 165   3                      }
 166   2                      setread(1);
 167   2                      *(resdata+index) = 0;//清空数据
 168   2              }
 169   1              selectindex =  selectid(idsta);
 170   1              if(selectindex != UNKNOWERROR)
 171   1              {
 172   2                      //查找到了
 173   2                      number--;
 174   2                      delectidbyindex(selectindex);
 175   2                      sprintf(str,"NO.%d-OUT-;number is.%d.",(int)selectindex,(int)number);
 176   2              }
 177   1              else
C51 COMPILER V9.00   CONTROLLER                                                            04/10/2017 20:02:32 PAGE 4   

 178   1              {
 179   2                      //没有找到
 180   2                      insertindex = insertid(idsta);
 181   2                      if(insertindex == UNKNOWERROR) 
 182   2                      {
 183   3                              LCDprintf("--FULL--");
 184   3                              LCDprintf("--callme--13077661594");
 185   3                              return;
 186   3                      } 
 187   2                      number++;
 188   2                      sprintf(str,"NO.%d-IN-;number is。%d。",(int)insertindex,(int)number);
 189   2              }
 190   1              LCDprintf(str); 
 191   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    985    ----
   CONSTANT SIZE    =    193    ----
   XDATA SIZE       =     22     126
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
